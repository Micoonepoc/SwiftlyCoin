//
//  MarketDataModel.swift
//  SwiftlyCoin
//
//  Created by Михаил on 19.01.2024.
//

import Foundation

// Goingeko API responce
/*
 
 https://api.coingecko.com/api/v3/global
 
 {
   "data": {
     "active_cryptocurrencies": 12334,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 980,
     "total_market_cap": {
       "btc": 41244101.0923194,
       "eth": 690866206.5122681,
       "ltc": 24308422095.805336,
       "bch": 7296691102.062082,
       "bnb": 5495138286.360002,
       "eos": 2401669138551.0146,
       "xrp": 3152942148023.6353,
       "xlm": 15156208398266.604,
       "link": 111364607745.25095,
       "dot": 250674718386.7862,
       "yfi": 232870112.51426163,
       "usd": 1713134831981.0037,
       "aed": 6292087267641.421,
       "ars": 1404323444312086.2,
       "aud": 2596182173069.4365,
       "bdt": 188132736040490.12,
       "bhd": 645637689802.8407,
       "bmd": 1713134831981.0037,
       "brl": 8448324423914.31,
       "cad": 2300765776372.9688,
       "chf": 1487619475833.8582,
       "clp": 1559295324069113,
       "cny": 12190324837410.432,
       "czk": 38963026391261.25,
       "dkk": 11726486729112.248,
       "eur": 1572400805533.7683,
       "gbp": 1348718503656.8367,
       "gel": 4548372978909.586,
       "hkd": 13393397757056.742,
       "huf": 600885204764236.8,
       "idr": 26735439158120356,
       "ils": 6413634183970.48,
       "inr": 142373575285647.6,
       "jpy": 253713983765263,
       "krw": 2285952510196416.5,
       "kwd": 527344016519.7192,
       "lkr": 549241669126684.7,
       "mmk": 3599878167082259,
       "mxn": 29271067154283.766,
       "myr": 8075717597958.455,
       "ngn": 1526471660688353.8,
       "nok": 17978388992999.906,
       "nzd": 2800680791097.8433,
       "php": 95724831580333.05,
       "pkr": 479849066437880.6,
       "pln": 6846483396292.959,
       "rub": 151070091831480.1,
       "sar": 6425199557221.197,
       "sek": 17935822731829.695,
       "sgd": 2295732586236.61,
       "thb": 60853689408112.34,
       "try": 51739138839984.62,
       "twd": 53790722302506.3,
       "uah": 64537518615253.64,
       "vef": 171536190726.25815,
       "vnd": 42055604866922856,
       "zar": 32615406144906.305,
       "xdr": 1288080383144.0376,
       "xag": 75809145775.72234,
       "xau": 844147188.458642,
       "bits": 41244101092319.4,
       "sats": 4124410109231940
     },
     "total_volume": {
       "btc": 2161373.3657958773,
       "eth": 36204445.69131663,
       "ltc": 1273868861.0231764,
       "bch": 382378895.1330461,
       "bnb": 287969557.3172641,
       "eos": 125858088115.41191,
       "xrp": 165228117528.36526,
       "xlm": 794252372845.7635,
       "link": 5835998135.445232,
       "dot": 13136464256.714706,
       "yfi": 12203424.139408482,
       "usd": 89775844297.6581,
       "aed": 329733209728.6531,
       "ars": 73592761367373.1,
       "aud": 136051431671.7961,
       "bdt": 9858987688979.95,
       "bhd": 33834271319.679893,
       "bmd": 89775844297.6581,
       "brl": 442729576153.9004,
       "cad": 120570305529.41936,
       "chf": 77957841930.15878,
       "clp": 81713973479728.6,
       "cny": 638826952853.2758,
       "czk": 2041834959728.4941,
       "dkk": 614519783906.3077,
       "eur": 82400758688.6057,
       "gbp": 70678816474.50458,
       "gel": 238354866610.28336,
       "hkd": 701873296373.1266,
       "huf": 31489043113612.15,
       "idr": 1401055292485897.8,
       "ils": 336102805881.5723,
       "inr": 7461005221734.312,
       "jpy": 13295735208599.959,
       "krw": 119794024846206.52,
       "kwd": 27635159495.082237,
       "lkr": 28782693369373.895,
       "mmk": 188649542222429.9,
       "mxn": 1533933417389.305,
       "myr": 423203330019.16046,
       "ngn": 79993868302985.28,
       "nok": 942147121655.2715,
       "nzd": 146768063981.45197,
       "php": 5016404672268.562,
       "pkr": 25146213987774.113,
       "pln": 358786019581.04004,
       "rub": 7916741163106.687,
       "sar": 336708882606.4265,
       "sek": 939916461252.0087,
       "sgd": 120306544098.8729,
       "thb": 3189002548575.417,
       "try": 2711359775005.0767,
       "twd": 2818871824878.0073,
       "uah": 3382051496705.817,
       "vef": 8989255289.524519,
       "vnd": 2203899753769389.5,
       "zar": 1709191576231.0867,
       "xdr": 67501110689.7447,
       "xag": 3972734626.8651323,
       "xau": 44237047.27767115,
       "bits": 2161373365795.8772,
       "sats": 216137336579587.72
     },
     "market_cap_percentage": {
       "btc": 47.52880998748717,
       "eth": 17.395110025673866,
       "usdt": 5.5339479585172375,
       "bnb": 2.798646934823859,
       "sol": 2.3437002848221,
       "xrp": 1.7238006584540828,
       "usdc": 1.4834677401518999,
       "steth": 1.3495985702442295,
       "ada": 1.014118129374603,
       "avax": 0.6962654893817963
     },
     "market_cap_change_percentage_24h_usd": 0.8373970465501168,
     "updated_at": 1705699972
   }
 }
 
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: {$0.key == "usd"}) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: {$0.key == "usd"}) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: {$0.key == "btc"}) {
            return item.value.asStringPercent()
        }
        return ""
    }
}
